<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="An Event Loop on the browser and JavaScript Language"><title>Event Loop</title><link rel=canonical href=https://xph0816.github.io/p/event-loop/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Event Loop"><meta property="og:description" content="An Event Loop on the browser and JavaScript Language"><meta property="og:url" content="https://xph0816.github.io/p/event-loop/"><meta property="og:site_name" content="Song's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Frontend"><meta property="article:tag" content="Computer Knowledge"><meta property="article:tag" content="Browser"><meta property="article:published_time" content="2023-08-19T00:00:00+08:00"><meta property="article:modified_time" content="2023-08-19T00:00:00+08:00"><meta property="og:image" content="https://developer.chrome.com/static/blog/inside-browser-part1/image/browser-architecture-9d143004c2a63_856.png"><meta name=twitter:title content="Event Loop"><meta name=twitter:description content="An Event Loop on the browser and JavaScript Language"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://developer.chrome.com/static/blog/inside-browser-part1/image/browser-architecture-9d143004c2a63_856.png"><link rel="shortcut icon" href=/favicon.svg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu12ef359483bc258b4d0472d73331359c_69166_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>üìñ</span></figure><div class=site-meta><h1 class=site-name><a href=/>Song's Blog</a></h1><h2 class=site-description>Studying</h2></div></header><ol class=social-menu><li><a href=https://github.com/XPH0816 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lss0816/ target=_blank title=Linkedin rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=/img/qrcode.png target=_blank title=WeChat rel=me><!doctype html><svg t="1676174392026" class="icon" viewBox="0 0 1194 1024" xmlns="http://www.w3.org/2000/svg" p-id="2999" xmlns:xlink="http://www.w3.org/1999/xlink" width="233.203125" height="200"><path d="M728.064 535.296a35.498667 35.498667.0 11-70.912.0 35.498667 35.498667.0 0170.912.0m246.016.0a35.498667 35.498667.0 11-70.997333.0 35.498667 35.498667.0 0170.997333.0" fill="#cdcdcd" p-id="3e3"/><path d="M902.144 930.133333l-6.656 1.450667a594.176 594.176.0 01-18.602667 3.669333c-26.453333 4.778667-44.629333 6.826667-64 6.144C645.034666 935.850666 514.218666 853.504 461.824 722.688a446.464 446.464.0 01-6.826667-19.114667l-1.962666-6.058666a199.68 199.68.0 01-3.84-13.653334 338.858667 338.858667.0 01-9.216-75.690666c0-171.008 157.013333-305.92 354.304-314.709334l8.874666-.682666c7.850667-.597333 12.970667-.853333 18.773334-.853334h14.762666l9.301334.170667c188.16 14.677333 340.394667 156.672 340.394666 323.925333.0 78.336-38.826667 155.733333-109.653333 222.293334a303.530667 303.530667.0 01-7.082667 6.4l9.984 71.082666a49.152 49.152.0 01-69.12 58.453334l-98.816-46.421334a582.485333 582.485333.0 01-9.472 2.304zm220.16-314.026666c0-131.754667-124.586667-247.978667-279.125333-260.096H821.930667c-3.754667.0-7.68.085333-13.994667.597333l-10.666667.768C631.466667 364.8 503.978667 474.453333 503.978667 608.256c0 18.773333 2.730667 40.874667 7.509333 60.842667.597333 2.474667 1.450667 5.632 2.56 9.216l1.706667 4.949333c2.133333 6.570667 4.266667 12.629333 5.632 15.957333 42.325333 105.728 149.930667 173.397333 293.717333 178.176 13.738667.512 28.16-1.109333 50.346667-5.12a531.626667 531.626667.0 0016.64-3.242666l5.632-1.28c4.693333-1.109333 8.448-1.962667 19.370666-4.778667a32 32 0 0121.418667 2.133333L1013.76 905.216l-9.984-69.290667a32 32 0 0113.909333-31.232c1.194667-.853333 8.618667-6.912 15.189334-13.056 58.709333-55.210667 89.429333-116.394667 89.429333-175.616zM12.970667 378.197333C12.970667 171.52 206.677333 5.376 442.709333 5.376c208.384.0 394.24 130.304 431.872 306.090667 1.28 5.973333 1.28 11.264.512 16.896a32 32 0 01-63.658666-5.973334C779.178667 179.2 621.482667 69.376 442.709333 69.376c-202.666666.0-365.738666 139.776-365.738666 308.906667.0 89.941333 46.165333 171.52 136.021333 237.568a32 32 0 0111.434667 35.84l-23.296 69.973333 104.96-48.896a32 32 0 0122.442666-1.706667l5.461334 1.706667c54.357333 11.093333 76.288 14.506667 108.714666 14.506667a200.789333 200.789333.0 0032.256-4.010667c-.512.170667-1.536.512-2.730666 1.536a33.109333 33.109333.0 0139.253333 1.109333A32 32 0 01516.864 730.88c-11.776 14.848-47.36 20.309333-74.24 20.309333-37.12.0-62.037333-3.584-119.893333-15.530666L198.570667 793.6a49.493333 49.493333.0 01-68.949334-59.733333l26.88-80.64c-93.525333-75.52-143.530666-170.24-143.530666-275.029334z" fill="#cdcdcd" p-id="3001"/><path d="M344.576 254.378667a44.373333 44.373333.0 11-88.746667.085333 44.373333 44.373333.0 0188.746667.0M636.586667 254.378667A44.373333 44.373333.0 11547.84 254.464a44.373333 44.373333.0 0188.746667.0" fill="#cdcdcd" p-id="3002"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/projects/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-stars" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17.8 19.817l-2.172 1.138a.392.392.0 01-.568-.41l.415-2.411-1.757-1.707a.389.389.0 01.217-.665l2.428-.352 1.086-2.193a.392.392.0 01.702.0l1.086 2.193 2.428.352a.39.39.0 01.217.665l-1.757 1.707.414 2.41a.39.39.0 01-.567.411L17.8 19.817z"/><path d="M6.2 19.817l-2.172 1.138a.392.392.0 01-.568-.41l.415-2.411-1.757-1.707a.389.389.0 01.217-.665l2.428-.352 1.086-2.193a.392.392.0 01.702.0l1.086 2.193 2.428.352a.39.39.0 01.217.665l-1.757 1.707.414 2.41a.39.39.0 01-.567.411L6.2 19.817z"/><path d="M12 9.817l-2.172 1.138a.392.392.0 01-.568-.41l.415-2.411-1.757-1.707a.389.389.0 01.217-.665l2.428-.352 1.086-2.193a.392.392.0 01.702.0l1.086 2.193 2.428.352a.39.39.0 01.217.665l-1.757 1.707.414 2.41a.39.39.0 01-.567.411L12 9.817z"/></svg><span>Projects</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://xph0816.github.io/ selected>English</option><option value=https://xph0816.github.io/zhcn/>ÁÆÄ‰Ωì‰∏≠Êñá</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#process-model-of-browser>Process Model of Browser</a><ol><li><a href=#what-is-a-process>What is a Process?</a></li><li><a href=#what-is-a-thread>What is a Thread?</a></li><li><a href=#browser-have-which-processes-and-threads>Browser have which processes and threads?</a></li><li><a href=#how-does-the-renderer-main-thread-work>How does the Renderer Main Thread work?</a></li></ol></li><li><a href=#some-explaination>Some Explaination</a><ol><li><a href=#what-is-asynchronous>What is Asynchronous?</a></li><li><a href=#how-js-block-the-rendering>How JS block the rendering?</a></li><li><a href=#priority-of-the-message-queue>Priority of the Message Queue</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/event-loop/><img src=https://developer.chrome.com/static/blog/inside-browser-part1/image/browser-architecture-9d143004c2a63_856.png loading=lazy alt="Featured image of post Event Loop"></a></div><div class=article-details><header class=article-category><a href=/categories/frontend-development/ style=background-color:#2a9d8f;color:#fff>Frontend Development</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/event-loop/>Event Loop</a></h2><h3 class=article-subtitle>An Event Loop on the browser and JavaScript Language</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Aug 19, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>8 minute read</time></div></footer><footer class=article-translations><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><div><a href=https://xph0816.github.io/zhcn/p/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/ class=link>ÁÆÄ‰Ωì‰∏≠Êñá</a></div></footer></div></header><section class=article-content><h2 id=process-model-of-browser>Process Model of Browser</h2><hr><h3 id=what-is-a-process>What is a Process?</h3><p>Every program has their own memory space, and the program can only access the memory space of itself. This memory space is called <strong>Process</strong>.</p><p>Each program has at least one process, and processes are isolated from each other. If a program wants to access the memory space of another program, it must use <strong>Inter-Process Communication</strong>, and need to be authorized by the operating system.</p><hr><h3 id=what-is-a-thread>What is a Thread?</h3><p>Once a process is created, it will have at least one thread, which is called <strong>Main Thread</strong>.
If the program wants to do multiple things at the same time, it needs to create multiple threads.</p><hr><h3 id=browser-have-which-processes-and-threads>Browser have which processes and threads?</h3><p>Browser is a multi-process and multi-threaded program.
Multi-process uses to reduce the risk of crash, when open the browser, it will automatically create many processes.
The main processes are:</p><ul><li>Browser Process</li><li>Network Process</li><li>Renderer Process</li><li>GPU Process</li><li>Storage Service Process</li><li>Audio Service Process</li></ul><p><img src=/p/event-loop/browser-process.png width=1294 height=493 srcset="/p/event-loop/browser-process_hu4987a3a4161049fecad3d666a92a45ca_36462_480x0_resize_box_3.png 480w, /p/event-loop/browser-process_hu4987a3a4161049fecad3d666a92a45ca_36462_1024x0_resize_box_3.png 1024w" loading=lazy alt="Proof of Browser Process" class=gallery-image data-flex-grow=262 data-flex-basis=629px></p><p>The Most important processes are:</p><ol><li>Browser Process<ul><li>Mainly responsible for interface display, user interaction, sub-process management, etc. The browser process will start multiple threads to handle different tasks.</li></ul></li><li>Network Process<ul><li>Responsible for loading network resources. The network process will start multiple threads to handle different network tasks.</li></ul></li><li><strong>Renderer Process</strong> (The main process we will talk about in this lesson)<ul><li>After the renderer process is started, it will open a <strong>Renderer Main Thread</strong>, which is responsible for executing HTML, CSS, and JS code.</li><li>By default, the browser will open a new renderer process for each tab to ensure that different tabs do not affect each other.</li></ul><blockquote><p>This default mode may change in the future. Interested students can refer to the <a class=link href=https://chromium.googlesource.com/chromium/src/+/main/docs/process_model_and_site_isolation.md#Modes-and-Availability target=_blank rel=noopener>chrome official documentation</a></p></blockquote></li></ol><p><img src=https://developer.chrome.com/static/blog/inside-browser-part1/image/chrome-processes-79aaecca78d23_856.png loading=lazy alt="Process and What it controls"></p><hr><h3 id=how-does-the-renderer-main-thread-work>How does the Renderer Main Thread work?</h3><p>The renderer main thread is the busiest thread in the browser. The tasks it needs to handle include but are not limited to:</p><ul><li>Parse HTML</li><li>Parse CSS</li><li>Calculate style</li><li>Layout</li><li>Paint</li><li>Compositing</li><li>Every frame rendering (60fps)</li><li>Execute JS code</li><li>Handle user interaction</li><li>Handle timer events</li><li>Handle network events</li><li>&mldr;&mldr; and more</li></ul><blockquote><p>Q: Why render process don&rsquo;t use multiple threads to handle these tasks?</p></blockquote><blockquote><p>A: Because the tasks are related to each other, and the order of execution is very important. If multiple threads are used to handle these tasks, it will be very difficult to ensure the order of execution.</p></blockquote><p>Main render thread faces a lot of tasks, and how does it schedule these tasks?
example:</p><ul><li>When the main thread is executing a JS code, how does it handle the user&rsquo;s click event?</li><li>When the main thread is executing a JS code, the timer event is triggered, how does it handle the timer event?</li><li>Browser process annouce that user click a button, and the same time, the timer event is triggered, how does the main thread handle these two events?</li><li>&mldr;</li></ul><p>Main thread use message queue to schedule these tasks.</p><p><img src=/p/event-loop/message-quering.png width=1030 height=446 srcset="/p/event-loop/message-quering_hu2c839b8caecaca8f2c3298d98e521dd5_49833_480x0_resize_box_3.png 480w, /p/event-loop/message-quering_hu2c839b8caecaca8f2c3298d98e521dd5_49833_1024x0_resize_box_3.png 1024w" loading=lazy alt="Message Queue" class=gallery-image data-flex-grow=230 data-flex-basis=554px></p><ol><li>From the beginning, main thread will enter the <strong>Event Loop</strong>.</li><li>Event Loop will check if there is any task in the <strong>Message Queue</strong>. If there is a task, it will take the task out of the message queue and execute it immediately. If not, it will wait for the task to be added to the message queue and enter the sleep state.</li><li>Other threads (including other threads in the other processes) can add tasks to the message queue at any time. New tasks will be added to the end of the message queue. When new tasks are added, the main thread will wake up and take the task out of the message queue and execute it immediately.</li></ol><p>In this way, each task can be carried out in an orderly and continuous manner</p><p><strong>The Whole Process is called Event Loop</strong></p><h2 id=some-explaination>Some Explaination</h2><h3 id=what-is-asynchronous>What is Asynchronous?</h3><p>Code in execution, there will be some tasks that cannot process immediately, Example:</p><ul><li>Tasks that need to be performed after the timer is triggered &ndash; <code>setTimeout</code>, <code>setInterval</code></li><li>Tasks that need to be performed after the network request is completed &ndash; <code>fetch</code>, <code>XMLHttpRequest</code></li><li>Tasks that need to be performed after the user action is triggered &ndash; <code>addEventListener</code>
if main thread wait for these tasks to complete, it will block the main thread, and the main thread will not be able to handle other tasks, which will cause the page to freeze.</li></ul><p><img src=/p/event-loop/main-thread-block.png width=1134 height=456 srcset="/p/event-loop/main-thread-block_hu4230c6300686cf6351e7c3a4c409c313_99857_480x0_resize_box_3.png 480w, /p/event-loop/main-thread-block_hu4230c6300686cf6351e7c3a4c409c313_99857_1024x0_resize_box_3.png 1024w" loading=lazy alt="Main Thread Block" class=gallery-image data-flex-grow=248 data-flex-basis=596px></p><p><strong>Main thread focus on most important tasks, it must not be blocked.</strong>
So, browser will use <strong>Asynchronous</strong> to handle these tasks.
Use <strong>Asynchronous</strong> to handle these tasks, the main thread will not be blocked.</p><p><img src=/p/event-loop/main-thread-asynchronous.png width=1172 height=500 srcset="/p/event-loop/main-thread-asynchronous_hudf7f154a3e68e4afa1a10d972f07f4f1_96830_480x0_resize_box_3.png 480w, /p/event-loop/main-thread-asynchronous_hudf7f154a3e68e4afa1a10d972f07f4f1_96830_1024x0_resize_box_3.png 1024w" loading=lazy alt="Main Thread Asynchronous" class=gallery-image data-flex-grow=234 data-flex-basis=562px></p><blockquote><p>Q: How do understand the asynchrony of JS?</p><p>Answer: JS is a single-threaded language, this is because the execution of JS code is performed in the main thread and main render thread is just only one thread and the main render thread need to handle a lot of tasks, like rendering, executing JS code, handling user interaction, handling timer events, handling network events, etc. Using synchronous to handle these tasks, the busy main thread will waste time in vain, and on the other hand, the page cannot be updated in time, causing the user to be stuck in the page. So the browser uses an asynchronous way to avoid it. The specific method is that when certain tasks occur, such as timers, network, and event monitoring, the main thread will hand over the tasks to other threads for processing, and immediately end the execution of the tasks by itself, and then execute subsequent codes. When other threads complete, wrap the callback function passed in advance into a task, add it to the end of the message queue, and wait for the main thread to schedule execution. In this asynchronous mode, the browser will never block, thus ensuring the smooth operation of single thread to the greatest extent.</p></blockquote><h3 id=how-js-block-the-rendering>How JS block the rendering?</h3><p>Here is an example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Hello World!<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span>change<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>h1</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;h1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>btn</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;button&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Ê≠ªÂæ™ÁéØÊåáÂÆöÁöÑÊó∂Èó¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>delay</span><span class=p>(</span><span class=nx>duration</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>start</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>start</span> <span class=o>&lt;</span> <span class=nx>duration</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>btn</span><span class=p>.</span><span class=nx>onclick</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>h1</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=s1>&#39;Don‚Äôt want to Hello the WorldÔºÅ&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>delay</span><span class=p>(</span><span class=mi>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>After click the button, the h1 text will change after 3 seconds.</p><h3 id=priority-of-the-message-queue>Priority of the Message Queue</h3><p>Task don&rsquo;t have priority, the message queue is FIFO (First In First Out).</p><p>But the message queue has priority.</p><p>According to Latest W3C standard:</p><ul><li>Every Task has a task type, the same task type must in the same queue, different task type must in different queue. In the Event Loop, browser will based on the task type to execute the task.</li><li>The browser must prepare a micro-queue, and tasks in the micro-queue are executed prior to all other tasks <a class=link href=https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint target=_blank rel=noopener>https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint</a></li></ul><blockquote><p>As the complexity of browsers has increased dramatically, the W3C no longer uses the term macro queue.</p></blockquote><p>In the Chrome browser, the message queue is divided into various types:</p><ul><li>Timer Task Queue: used to store the callback task after the timer arrives, the priority is &ldquo;medium&rdquo;</li><li>User Interaction Task Queue: used to store the callback task after the user interaction event is triggered, the priority is &ldquo;high&rdquo;</li><li>Micro Task Queue: used to store micro tasks, the priority is &ldquo;highest&rdquo;</li></ul><blockquote><p>Method to add micro task is to use <code>Promise, MutationObserver</code></p><p>Example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Add a function to the micro task immediately
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=nx>fn</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></blockquote><blockquote><p>There are many other queues in the browser, which are not considered because they have little to do with our development</p></blockquote><blockquote><p>Interview Question: Explain the event loop of JS</p><p>Answer:</p><p><strong>Event Loop</strong> a.k.a <strong>Message Loop</strong>, is the way the browser&rsquo;s rendering main thread works</p><p>In the Source Code of Chromium, it opens an endless for loop, and each loop will take the first task from the message queue and execute it, and other threads only need to add tasks to the end of the queue at the right time.</p><p>In the past, the message queue was simply divided into macro queues and micro queues. This statement is no longer applicable to the complex browser environment. Instead, it is a more flexible and changeable processing method.</p><p>According to the official explanation of W3C, each task has a different type, and tasks of the same type must be in the same queue, and tasks of different types can belong to different queues. Different task queues have different priorities. In one event loop, the browser can decide which queue to take tasks from according to the actual situation. However, the browser must have a micro queue, and the tasks in the micro queue must have the highest priority and must be scheduled for execution first.</p></blockquote><blockquote><p>Interview Question: Can the timer in JS be accurate? Why?</p><p>Answer:</p><p>Cannot be accurate, because:</p><ol><li>Computer hardware does not have an atomic clock, so it cannot be timed accurately.</li><li>The timing function of the operating system itself has a small deviation. Since the timer of JS ultimately calls the function of the operating system, it also carries these deviations</li><li>According to the W3C standard, when the browser implements the timer, if the nesting level exceeds 5 layers, it will have a minimum time of 4 milliseconds, which will bring deviations when the timing time is less than 4 milliseconds</li><li>Affected by the event loop, the callback function of the timer can only run when the main thread is idle, which brings deviations again</li></ol></blockquote><p><img src=/p/event-loop/cover.png width=1298 height=960 srcset="/p/event-loop/cover_hu6906da3f6e6f146e764f66363372123f_210693_480x0_resize_box_3.png 480w, /p/event-loop/cover_hu6906da3f6e6f146e764f66363372123f_210693_1024x0_resize_box_3.png 1024w" loading=lazy alt="Screenshot of the Event Loop" class=gallery-image data-flex-grow=135 data-flex-basis=324px></p></section><footer class=article-footer><section class=article-tags><a href=/tags/frontend/>Frontend</a>
<a href=/tags/computer-knowledge/>Computer Knowledge</a>
<a href=/tags/browser/>Browser</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 Song's Blog</section><section class=powerby>Sing Sing Song Song<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>